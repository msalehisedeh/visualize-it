{"version":3,"file":"sedeh-visualize-it.js.map","sources":["ng://@sedeh/visualize-it/src/app/visualize-it/components/visualize-it.component.ts","ng://@sedeh/visualize-it/src/app/visualize-it/visualize-it.module.ts"],"sourcesContent":["/*\r\n * tool to display result of a search on set of points of interests on objects.\r\n */\r\nimport {\r\n  Component,\r\n  OnInit,\r\n  OnChanges,\r\n  AfterViewInit ,\r\n  Input,\r\n  Output,\r\n  ViewChild,\r\n  EventEmitter,\r\n  ElementRef\r\n} from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'visualize-it',\r\n  templateUrl: './visualize-it.component.html',\r\n  styleUrls: ['./visualize-it.component.scss'],\r\n})\r\nexport class VisualizeItComponent implements OnInit, AfterViewInit, OnChanges  {\r\n\r\n  showLegend = false;\r\n  showHelp = false;\r\n  expanded = false;\r\n  \r\n  @Input(\"showCurvedConnections\")\r\n  showCurvedConnections: string;\r\n  \r\n  @Input(\"enableTooltip\")\r\n  enableTooltip: boolean;\r\n\r\n  @Input(\"gradientsEnabled\")\r\n  gradientsEnabled = true;\r\n\r\n  @Input(\"repealForce\")\r\n  repealForce = 300;\r\n  \r\n  @Input(\"fixedDistance\")\r\n  fixedDistance = 60;\r\n  \r\n  @Input(\"outlineNodes\")\r\n  outlineNodes: boolean;\r\n\r\n  @Input(\"enableLegends\")\r\n  enableLegends: boolean;\r\n\r\n  @Input(\"showTypeOnHover\")\r\n  showTypeOnHover: boolean;\r\n\r\n  @Input(\"showDirections\")\r\n  showDirections: boolean;\r\n\r\n  @Input(\"data\")\r\n  data: any;\r\n\r\n  @Input(\"typeMapping\")\r\n  typeMapping = {};\r\n\r\n  @Input(\"width\")\r\n  width: string;\r\n\r\n  @Input(\"height\")\r\n  height: string;\r\n\r\n  @Output(\"onVisualization\")\r\n  onVisualization = new EventEmitter();\r\n\r\n  @ViewChild(\"d3Container\")\r\n  d3Container;\r\n\r\n  constructor() {\r\n    if (navigator.platform.toUpperCase().indexOf('MAC')<0) {\r\n      document.addEventListener(\"webkitfullscreenchange\", (event) => {\r\n        if(!window.screenTop && !window.screenY) {\r\n          this.expand(false);\r\n        }\r\n      });\r\n      document.addEventListener(\"mozfullscreenchange\", (event) => {\r\n        const win: any = window;\r\n        const isFullScreen = win.fullScreen ||\r\n                            (win.innerWidth == screen.width && win.innerHeight == screen.height)\r\n        if(!isFullScreen) {\r\n          this.expand(false);\r\n        }\r\n      });\r\n      document.addEventListener(\"MSFullscreenChange\", (event) => {\r\n        const win: any = window;\r\n        const isFullScreen = win.fullScreen ||\r\n                            (win.innerWidth == screen.width && win.innerHeight == screen.height)\r\n        if(!isFullScreen) {\r\n          this.expand(false);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private triggerEvaluation(points) {\r\n    if (points.length) {\r\n      const indexOf = {};\r\n      const errors = [];\r\n      const dataSet = {\r\n        links:[],\r\n        nodes: []\r\n      };\r\n      this.d3Container.nativeElement.innerHTML = \"\";\r\n      points.map( (node,index) => indexOf[node.id] = index);\r\n      points.map( (node, i) => {\r\n        dataSet.nodes.push({\r\n          size: node.size ? node.size: 10, \r\n          group: node.group? node.group : 0, \r\n          type: node.type && node.type.length ? node.type : \"circle\",\r\n          name: node.name,\r\n          image: node.image,\r\n          data: node.data ? node.data : []\r\n        });\r\n        if(node.sources) {\r\n          node.sources.map( (id) => {\r\n            const item = indexOf[id];\r\n            if (item != undefined) {\r\n              dataSet.links.push({source: item, target: i});\r\n            } else {\r\n              errors.push(\"Missing source node '\" + id + \"' for node '\" + node.id + \"'.\");\r\n            }\r\n          })\r\n        }\r\n        if(node.destinations) {\r\n          node.destinations.map( (id) => {\r\n            const item = indexOf[id];\r\n            if (item != undefined) {\r\n              dataSet.links.push({source: i, target: item});\r\n            } else {\r\n              errors.push(\"Missing destination node '\" + id + \"' for node '\" + node.id + \"'.\");\r\n            }\r\n          })\r\n        }\r\n      });\r\n\r\n      if (errors.length) {\r\n        this.d3Container.nativeElement.innerHTML = \"<div class='danger'>\"+errors.join(\"<br/>\")+\"</div>\";\r\n      } else {\r\n        const el = this.d3Container.nativeElement.parentNode;\r\n        const config = {\r\n          width: window.innerWidth, \r\n          height: window.innerHeight,\r\n          offset: {x: el.offsetLeft, y: el.offsetTop}, \r\n          data: dataSet,\r\n          mapping: this.typeMapping, \r\n          showTypeOnHover: this.showTypeOnHover, \r\n          showDirections: this.showDirections,\r\n          enableTooltip: this.enableTooltip,\r\n          showCurvedConnections: this.showCurvedConnections,\r\n          outlineNodes: this.outlineNodes,\r\n          charge: -1 * this.repealForce,\r\n          fixedDistance: this.fixedDistance,\r\n          gradientsEnabled: this.gradientsEnabled,\r\n          targetDiv: \"#d3-container\"\r\n        };\r\n        window['initiateD3'](config);\r\n      }\r\n    } else {\r\n      this.d3Container.nativeElement.innerHTML = \"<div class='danger'>Missing data.</div>\";\r\n    }\r\n  }\r\n\r\n  ngOnChanges(changes: any) {\r\n    if (changes.data) {\r\n      setTimeout(this.ngOnInit.bind(this), 333);\r\n    }\r\n  }\r\n\r\n  ngOnInit() {\r\n    if( !(this.data instanceof Array)) {\r\n      this.data = [this.data];\r\n    }\r\n  }\r\n\r\n  async ngAfterViewInit() {\r\n    if (!window['initiateD3']) {\r\n      await this.loadScript(\"assets/d3.js\", 'd3js').then( () => {\r\n        this.triggerEvaluation(this.data);\r\n      });\r\n    } else {\r\n      this.triggerEvaluation(this.data);\r\n    }\r\n \t}\r\n   \r\n\tprivate loadScript(url, id) {    \r\n    return new Promise((resolve, reject) => {\r\n      const scriptElement = document.createElement('script');\r\n    \r\n      scriptElement.type = \"text/javascript\";\r\n      scriptElement.src = url;\r\n      scriptElement.onload = resolve;\r\n      \r\n      document.body.appendChild(scriptElement);\r\n\t\t})\r\n  }\r\n\r\n  expand(flag) {\r\n    const doc: any = document;\r\n\r\n    if (flag) {\r\n      const el = this.d3Container.nativeElement.parentNode;\r\n      const element: any = doc.documentElement;\r\n      if(element.requestFullscreen) {\r\n        element.requestFullscreen();\r\n      } else if(element.mozRequestFullScreen) {\r\n        element.mozRequestFullScreen();\r\n      } else if(element.webkitRequestFullscreen) {\r\n        element.webkitRequestFullscreen();\r\n      } else if(element.msRequestFullscreen) {\r\n        element.msRequestFullscreen();\r\n      }\r\n      el.classList.add(\"expanded-container\");\r\n      this.expanded = true;\r\n      if (window[\"centerVisibility\"]) {\r\n        window[\"centerVisibility\"](0, 0);\r\n      }\r\n    } else {\r\n      if(doc.exitFullscreen) {\r\n        doc.exitFullscreen();\r\n      } else if(doc.mozCancelFullScreen) {\r\n        doc.mozCancelFullScreen();\r\n      } else if(doc.webkitExitFullscreen) {\r\n        doc.webkitExitFullscreen();\r\n      }\r\n      const el = this.d3Container.nativeElement.parentNode;\r\n      el.classList.remove(\"expanded-container\");\r\n      this.expanded = false;\r\n      if (window[\"centerVisibility\"]) {\r\n        window[\"centerVisibility\"](el.offsetLeft, el.offsetTop);\r\n      }\r\n    }\r\n  }\r\n\r\n  onchange(event) {\r\n    this.triggerEvaluation(event.points);\r\n  }\r\n}\r\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { VisualizeItComponent } from './components/visualize-it.component';\r\n\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  declarations: [\r\n    VisualizeItComponent\r\n  ],\r\n  exports: [\r\n    VisualizeItComponent\r\n  ],\r\n  entryComponents: [\r\n    VisualizeItComponent\r\n  ],\r\n  providers: [\r\n  ],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\n\r\nexport class VisualizeItModule {}\r\n"],"names":[],"mappings":"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"}
